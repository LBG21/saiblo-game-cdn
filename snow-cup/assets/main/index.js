window.__require=function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){return r(t[s][1][e]||e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<n.length;s++)r(n[s]);return r}({Eggs:[function(t,i){"use strict";cc._RF.push(i,"6ebe0cy5sdAYKyk6kzLX/a7","Eggs");var n=15,r=12;function o(e){for(var t=e.getUint16(8,!0),i=e.getUint16(10,!0),r=e.getUint32(12,!0),o=e.getUint32(16,!0),s=e.getUint32(20,!0),a=e.getUint32(24,!0),c=e.getUint32(28,!0),l=new Date(1e3*(c*Math.pow(2,32)+a)),u=[],p=0;p<n;p++)u[p]=e.getUint8(32+p);return{frameCount:t,fps:i,redScore:r,yellowScore:o,blueScore:s,timestamp:l,eggScores:u}}function s(e,t,i){for(var o=[],s=[],a=0;a<r;a++){var c=e.getFloat32(i+120+4*a,!0),l=e.getFloat32(i+168+4*a,!0),u=e.getUint8(i+228+a);o.push({id:a,position:[c,l],eggInHand:e.getInt8(i+216+a),endurance:u/255*5})}for(var p=0;p<n;p++){var d=e.getFloat32(i+4*p,!0),g=e.getFloat32(i+60+4*p,!0);s.push({id:p,position:[d,g],score:t[p]})}return{playerInfo:o,eggInfo:s}}function a(e){var t,i=new DataView(e);if("THAIEG"!==(t=e.slice(0,6),String.fromCharCode.apply(null,Array.from(new Uint8Array(t))))||1!==i.getUint16(6,!0))return null;for(var n=o(i),r=[],a=0,c=47;a<n.frameCount;a++,c+=240)r.push(s(i,n.eggScores,c));return{header:n,frames:r}}function c(e){return e>=0?e:-e}function l(e,t){return e>t?t:e}cc.Class({extends:cc.Component,properties:{containerId:{default:"_filebox_container_",visible:!1},inputBoxId:{default:"_filebox_input_",visible:!1},isPlaying:{default:!1,visible:!1},status:{default:-1,visible:!1},count:{default:0,type:cc.Integer,visible:!1},limitCount:{default:0,type:cc.Integer,visible:!1},header:{default:null,type:cc.Array,visible:!1},frames:{default:null,type:cc.Array,visible:!1},Player:cc.Prefab,players:{default:[],type:[cc.Node],visible:!1},Egg:cc.Prefab,eggs:{default:[],type:[cc.Node],visible:!1},ground:{default:null,type:cc.Node},YellowImgs:{default:[],type:[cc.Texture2D]},RedImgs:{default:[],type:[cc.Texture2D]},BlueImgs:{default:[],type:[cc.Texture2D]},number:{default:null,type:cc.Node},framelabel:{default:null,type:cc.Node}},start:function(){this.initPlayer()},update:function(){if(this.isPlaying&&this.count<this.limitCount){for(var e=this.frames[this.count],t=e.playerInfo,i=0;i<12;++i){var n=t[i].id,r=t[i].position,o=(t[i].eggInHand,t[i].endurance);if(this.count>0){console.log(s);var s=this.playerImgTrans(this.players[n].position,this.positionTrans(r[0],r[1]));-1!=s&&(this.players[n].children[0].getComponent(cc.Sprite).spriteFrame=n<4?new cc.SpriteFrame(this.RedImgs[s]):n>7?new cc.SpriteFrame(this.BlueImgs[s]):new cc.SpriteFrame(this.YellowImgs[s]))}this.players[n].position=this.positionTrans(r[0],r[1]),this.players[n].children[2].getComponent(cc.ProgressBar).progress=o/5,console.log(this.players[n].children[2])}for(var a=e.eggInfo,c=0;c<15;++c){var l=a[c].id,u=a[c].position,p=a[c].score;this.eggs[l].position=this.positionTrans(u[0],u[1]),this.eggs[l].getChildByName("score").getComponent(cc.Label).string=String(p)}for(var d=[],g=0;g<12;++g)d.push(this.players[g]);for(var f=0;f<15;++f)d.push(this.eggs[f]);d.sort(function(e,t){return t.y-e.y});for(var h=0;h<27;++h)d[h].zIndex=h;console.log(this.count),this.framelabel.getComponent(cc.Label).string="\u5f53\u524d\u5e27: "+String(this.count),this.count=this.count+1}},step:function(){this.limitCount=l(this.limitCount+1,this.header.frameCount)},startSetp:function(){this.limitCount=this.count},continue:function(){this.limitCount=this.header.frameCount},restart:function(){this.count=0,this.limitCount=1},skipTo:function(){var e=this.number.getComponent(cc.EditBox).string,t=0;NaN!=Number(e)?t=l(Number(e),this.header.frameCount-1):this.number.getComponent(cc.EditBox).string="0",this.count=t,this.limitCount=t+1},InitGPE:function(){for(var e=cc.find("Canvas"),t=0;t<12;++t)this.players.push(cc.instantiate(this.Player)),this.players[t].getChildByName("id").getComponent(cc.Label).string=String(t),this.players[t].getChildByName("img").getComponent(cc.Sprite).spriteFrame=t<4?new cc.SpriteFrame(this.RedImgs[0]):t>7?new cc.SpriteFrame(this.BlueImgs[0]):new cc.SpriteFrame(this.YellowImgs[0]),e.addChild(this.players[t]),cc.game.setFrameRate(this.header.fps);for(var i=0;i<15;++i)this.eggs.push(cc.instantiate(this.Egg)),this.eggs[i].getChildByName("id").getComponent(cc.Label).string=String(i),e.addChild(this.eggs[i]);this.isPlaying=!0,this.limitCount=0},initPlayer:function(){var t=this;if(!this.loaded){if(console.log("Try reading record file..."),!window.saiblo)return console.warn("Record file not received. Retry in 500ms..."),void setTimeout(this.initPlayer.bind(this),500);this.readFile(window.saiblo.replay,function(i){var n=a(i);t.header=n.header,t.frames=n.frames,t.InitGPE(),t.skipTo(),window.saiblo.confirmReplay(t.frames.length),console.log("Record file read."),t.loaded=!0}),window.saiblo.callback.loadFrame=function(e){t.skipTo(e)},window.saiblo.callback.nthisxtFrame=function(){t.step()}}},getInputBox:function(e,t){if(!this.inputBox){var i=document.getElementById(e);if(!i){var n=document.getElementById(t);n||(n=document.createElement("div"),document.body.appendChild(n),n.id=t),(i=document.createElement("input")).id=e,i.type="file",n.appendChild(i)}this.inputBox=i}return this.inputBox},onClick:function(){this.inputBox&&this.inputBox.click()},readFile:function(e,t){var i=new FileReader;i.onload=function(e){var i=e.target.result;t(i)},i.readAsArrayBuffer(e)},positionTrans:function(e,t){return e=12*e+this.ground.x+33.48,t=12*t+this.ground.y-3.5,cc.v2(e,t)},playerImgTrans:function(e,t){return console.log(e,t),e.y==t.y&&e.x==t.x?-1:c(e.y-t.y)>c(e.x-t.x)?e.y>t.y?0:1:e.x>t.x?2:3}}),cc._RF.pop()},{}],File:[function(e,t){"use strict";cc._RF.push(t,"698b3HpkKxJF5ifa7ys8BOK","File"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},update:function(){}}),cc._RF.pop()},{}]},{},["Eggs","File"]);
//# sourceMappingURL=index.js.map
